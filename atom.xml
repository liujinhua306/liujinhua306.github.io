<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://liujinhua306.github.io</id>
    <title>suisuipingan</title>
    <updated>2019-06-26T03:11:10.899Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://liujinhua306.github.io"/>
    <link rel="self" href="https://liujinhua306.github.io/atom.xml"/>
    <subtitle>温故而知新</subtitle>
    <logo>https://liujinhua306.github.io/images/avatar.png</logo>
    <icon>https://liujinhua306.github.io/favicon.ico</icon>
    <rights>All rights reserved 2019, suisuipingan</rights>
    <entry>
        <title type="html"><![CDATA[postgresql 脚本语句练习]]></title>
        <id>https://liujinhua306.github.io/post/postgresql</id>
        <link href="https://liujinhua306.github.io/post/postgresql">
        </link>
        <updated>2019-06-26T03:09:15.000Z</updated>
        <content type="html"><![CDATA[<pre><code class="language-sql">DO
$do$
BEGIN
IF EXISTS (SELECT 1 FROM orders) THEN
   DELETE FROM orders;
ELSE 
   INSERT INTO orders VALUES (1,2,3);
END IF;
END
$do$
</code></pre>
<pre><code class="language-sql">-- 查询t_sys_menu表的id并赋值给menu变量（menu变量是RECORD类型的） 然后for循环 查询t_sys_role_resource表
-- 中是否有该menuid的记录。没有就插入。 
DO $body$ DECLARE
menu RECORD;
BEGIN
    FOR menu IN ( SELECT recordid FROM t_sys_menu )
    LOOP
  IF
    ( SELECT COUNT ( 1 ) FROM t_sys_role_resource WHERE roleid = '1' AND menuid = menu.recordid ) = 0 --一定要加括号
  THEN
      INSERT INTO &quot;public&quot;.&quot;t_sys_role_resource&quot; ( &quot;recordid&quot;, &quot;roleid&quot;, &quot;menuid&quot;, &quot;buttons&quot; )
    VALUES
      ( menu.recordid, '1', menu.recordid, NULL );
    ELSE 
    --nothing to do;
    
  END IF;
  
END LOOP;

END;
$body$ LANGUAGE PLPGSQL;
</code></pre>
<pre><code class="language-sql">-- 查询出menuid后再赋值给menu_id
DO $body$ DECLARE
menu_id VARCHAR ( 1000 );
BEGIN
    menu_id=(select menuid from t_sys_role_resource where recordid='800005003' );
    update t_sys_menu set flag=0 where recordid=menu_id;
END;
$body$ LANGUAGE PLPGSQL;
</code></pre>
]]></content>
    </entry>
</feed>